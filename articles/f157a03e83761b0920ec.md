---
title: "GASã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ãªã‚‰ã€ŒCheeriosgsã€ãŒä¾¿åˆ©ï¼æœ€ä½è³ƒé‡‘APIã‚’ä½œã£ã¦ã¿ã‚‹"
emoji: "ğŸ“"
type: "tech"
topics: ["ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°", "API", "GAS", "cheerio"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯Qiitaã‹ã‚‰ç§»è¡Œã—ã¦ã„ã¾ã™ã€‚
:::

https://qiita.com/items/f157a03e83761b0920ec

-----

## ãŠè©«ã³
Qiitaã®å…ƒè¨˜äº‹ã«ã¦ã€åŒºåˆ‡ã‚Šç·šã‚’ã€Œ---ã€ã§æ›¸ã„ã¦ã„ã‚‹å ´æ‰€ãŒã‚ã‚Šã€ã“ã‚ŒãŒZennã®è¨˜æ³•ã«å¹²æ¸‰ã—ã¦ä¸€éƒ¨ã†ã¾ãè¡¨ç¤ºã§ããªã„è¨˜äº‹ãŒã‚ã‚‹äº‹ã‚’èªè­˜ã—ã¦ã„ã¾ã™ã€‚
å…¨ã¦ã®è¨˜äº‹ã‚’ç²¾æŸ»ã—ãã‚Œã¦ã„ãªã„ãŸã‚ã€ãŠæ‰‹æ•°ã§ã™ãŒãŠè¦‹ã‹ã‘ã®éš›ã¯æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¤§å¤‰å–œã³ã¾ã™ã€‚

-----

[æœ¬å®¶](https://takaya1992.hatenablog.jp/entry/2017/04/06/022344)ã®æ›´æ–°ãŒ2018å¹´ã§æ­¢ã¾ã£ã¦ã„ãŸã®ã§ã€æœ€æ–°ç‰ˆã«å¯¾å¿œã—ã¤ã¤GASã§ã‚‚ä½œã£ã¦ã¿ã‚‹ã€‚

# GASã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ãªã‚‰ã€ŒCheeriosgsã€ãŒä¾¿åˆ©ï¼æœ€ä½è³ƒé‡‘APIã‚’ä½œã£ã¦ã¿ã‚‹

ã„ã¤ã‚‚ã©ãŠã‚Šã€ã‚½ãƒ¼ã‚¹ã¯[Github](https://github.com/shimajima-eiji/Hosting/blob/GAS-minimum_wage/set.gs#L3-L74)ã€‚

<details><summary>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰</summary><div>
```
  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©
   */
  const years = [
    {
      name: "ä»¤å’Œ",
      start: 2019,
    },
  ];

  /**
   * ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°
   */    
  function replaces ( str )
  {
    return getDate( str ).trim()
      .replace( / /g, "" )
      .replace( /ã€€/g, "" )
      .replace( /\)/g, "" )
      .replace( /\(/g, "" )
      .replace( /[ï¼-ï¼™]/g, function ( word )
      {
        return String.fromCharCode( word.charCodeAt( 0 ) - 0xFEE0 )
      } );
  }
  function getDate ( str )
  {
    // æ—¥ä»˜ã§ãªã‘ã‚Œã°ã‚„ã‚‰ãªã„
    if ( str.indexOf( "å¹´" ) == -1 ) return str;

    // å¹´å·ã‚’è¥¿æš¦ã«ç›´ã™ã€‚
    var ad = -1;  // å…ƒå¹´åˆ†ã‚’æ¸›ã‚‰ã—ã¦ãŠããŸã‚-1
    years.forEach( function ( year )
    {
      if ( str.indexOf( year.name ) > -1 )
      {
        ad += year.start;
        str = str.replace( year.name, "" );
      }
    } );

    // å…ƒå¹´ã¯1å¹´
    str = str.replace( "å…ƒ", 1 )

    // è¥¿æš¦ã‚’ç®—å‡ºã—ã¦-ã§ã¤ãªã’ã‚‹
    var split = str.split( "å¹´" );  // 2æ¡ä»¥ä¸Šã®æ¤œå‡ºã«å¯¾å¿œ
    return ( Number( split[ 0 ] ) + ad )
      + "-"
      + split[ 1 ].replace( "æœˆ", "-" ).replace( "æ—¥", "" );
  }

  /**
   * ãƒ¡ã‚¤ãƒ³
   */
  const URL = PropertiesService.getScriptProperties().getProperties().url;
  const content = UrlFetchApp.fetch( URL ).getContentText();
  const $ = Cheerio.load( content );

  var result = [];
  var pointer = -1;
  const EXCLUDE_COLUMN = 3; // æœ€åˆã®è¡Œã ã‘ãŠã‹ã—ãªã‚‚ã®ãŒã‚ã‚‹ã®ã§é™¤å¤–
  const COLUMNS = 4;
  $( "td" ).each( function ( i, td )
  {
    if ( i < EXCLUDE_COLUMN ) return;
    if ( i % COLUMNS == EXCLUDE_COLUMN )
    {
      result.push( [] );
      pointer++;
    }
    result[ pointer ].push( replaces( $( td ).text() ) );
  } );
```
</div></details>

ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã§ã¤ã‚‰ã„ã®ã¯ã€ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã®å‡¦ç†ã§ã¯ãªãã€å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã€‚
å…·ä½“çš„ã«ã¯ã€

- å¿…è¦ãªéƒ¨åˆ†ã®æ‹¬ã‚Šå‡ºã—
- ä¸æ­£ãªå€¤ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šé™¤ãã€ç½®ãæ›ãˆã‚‹

ã“ã‚Œã‚’å¦‚ä½•ã«é ‘å¼µã‚‰ãªã„ã‹ãŒé‡è¦ã ã¨è€ƒãˆã‚‹ã€‚
pythonã ã¨ã¨ã‚Šã‚ãˆãšpandasè¾ºã‚Šã«å…¥ã‚Œã¦ã—ã¾ãˆï¼ã¨ãªã‚‹ãŒJavascriptã«ãã“ã¾ã§æ±‚ã‚ã‚‹ã®ã¯é…·ã ã‚ã†ã‹ã€‚

## Cheeriogs
[å…¬å¼](https://github.com/tani/cheeriogs)

ä½¿ã„æ–¹ã¯Cheerioã¨åŒã˜ãªã®ã§JQueryã§ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’ã—ã¦ã„ã‚‹äººã«ã¨ã£ã¦ã¯é¦´æŸ“ã¿ã‚„ã™ã„ã€‚

## å½“åˆæ¡ˆ
[Github(History)](https://github.com/shimajima-eiji/Hosting/commit/334503222be20d519d5cc5d9fbf88e163c732da9#diff-210a8378ce33326115f9b72aea5adcb2R3-R96)ã€‚

<details><summary>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰</summary><div>
```
  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©
   */
  var yearsname2ad = {
    "å…ƒå¹´": 2019,
  };
  const PROPERTIES = PropertiesService.getScriptProperties().getProperties();

  /**
   * ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚¸ãƒƒã‚¯
   */

  function __scraping ()
  {
    var html = UrlFetchApp.fetch( PROPERTIES.url ).getContentText( 'UTF-8' ).replace( /\r?\n/g, "" ).replace( /[ï¼-ï¼™]/g, function ( word )
    {
      return String.fromCharCode( word.charCodeAt( 0 ) - 0xFEE0 )
    } );
    var start = "<tbody>";
    var end = "</tbody>";
    return __cut( html, start, end );
  }

  var __match = {
    tr: /\<tr \w(.*?)\<\/tr\>/g,
    td: /\<td \w(.*?)\<\/td\>/g,
    year: /[\då…ƒ](.*)å¹´/g,
    month: /å¹´\d(.*)æœˆ/g,
    day: /æœˆ\d(.*)æ—¥/g,
    run: function ( str, pattern ) { return str.match( __match[ pattern ] ) },
  }
  function __cut ( str, sep )
  {
    return str.substring( str.indexOf( sep ) + sep.length, str.length );
  }
  function __rsubstring ( str, sep )
  {
    return str.substring( 0, str.indexOf( sep ) );
  }

  function __getYMD ( str, pattern )
  {
    var tmp = __match.run( str, pattern )[ 0 ]

    switch ( pattern )
    {
      case "year":
        tmp = yearsname2ad[ tmp ];
        break;

      case "month":
      case "day":
        tmp = tmp.substring( 1, tmp.length - 1 );
        if ( tmp.length == 1 ) tmp = "0" + tmp;
        break;
    }
    return tmp;
  }
  function __getDate ( str )
  {
    var year = __getYMD( str, "year" );
    var month = __getYMD( str, "month" );
    var day = __getYMD( str, "day" );
    return year + "-" + month + "-" + day;
  }

  /**
   * ãƒ¡ã‚¤ãƒ³
   */

  var table = __scraping()
  //  var table = test()

  /**
   * ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°
   */
  var tr_items = __match.run( table, "tr" );
  var td_items = tr_items.map( function ( tr )
  {
    var tds = __match.run( tr, "td" );
    return tds.map( function ( td )
    {
      var clean_td = __rsubstring( __cut( td, ">" ), "<" )
        .trim()
        .replace( / /g, "" )
        .replace( /ã€€/g, "" )
        .replace( /\(/g, "" )
        .replace( /\)/g, "" )
        ;
      if ( clean_td.indexOf( "å¹´" ) > -1 ) clean_td = __getDate( clean_td );
      return clean_td;
    } );
  } );
  td_items.shift();
```
</div></details>

ã“ã®ã‚ˆã†ã«ã€ã†ã¾ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’è€ƒãˆã‚‹ã—ã‹æ–¹æ³•ãŒæ€ã„ã¤ã‹ãªã‹ã£ãŸã€‚

ãªãŠã€`getDate`é–¢é€£ã¨`str.replace`ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã®ã§ã€ãã“ã¯ç›®ã‚’ç‘ã£ã¦ã»ã—ã„ã€‚

# å‹•ãã‚‚ã®
[Webç‰ˆ](https://shimajima-eiji.github.io/Hosting/man-month/)

![ç°¡æ˜“äººæœˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/122800/89d1c099-d5ec-ae0a-e02b-b90f7cb319a4.png)

Chromeæ‹¡å¼µæ©Ÿèƒ½ã«ã‚‚å¯¾å¿œã—ã¦ã„ã‚‹ã€‚

# æ‰‹å¼•
[æœ€ä½è³ƒé‡‘APIã‚’ä½¿ã£ã¦ç°¡æ˜“äººæœˆè¨ˆç®—æ©Ÿã‚’Chromeæ‹¡å¼µæ©Ÿèƒ½ã§ä½œã£ã¦ã¿ãŸ](https://note.com/nomuragoro/n/nf11cbbaf8f96)

